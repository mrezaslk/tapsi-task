# ูุนูุงุฑ ูพุฑูฺู (Architecture)

ุงู ูพุฑูฺู ฺฉ ูพุงุฏูโุณุงุฒ **Server-Side Rendering (SSR)** ุจุง React ู Node.js ุงุณุช ฺฉู ุชุฑฺฉุจ ุงุฒ SSR + SPA behavior + API ุฏุงุฑุฏ.

---

## ๐งฐ Tech Stack

- **Node.js + Express** ุจุฑุง ุณุฑูุฑ
- **React 19** ุจุฑุง UI (SSR + Hydration)
- **React Router v7** ุจุฑุง Routing
- **Vite** ุจุฑุง ุจุงูุฏู ุณูุช ฺฉูุงูุช (dev ู build)
- **TypeScript** ุจุฑุง type-safety
- **Tailwind CSS (v4)** ุจุฑุง ุทุฑุงุญ ููุจุงูโูุญูุฑ

---

## ๐ ุณุงุฎุชุงุฑ ูพุฑูฺู

```txt
.
โโโ package.json
โโโ vite.config.mjs                 # ุชูุธูุงุช Vite (ฺฉูุงูุช + Tailwind)
โโโ tsconfig.json
โโโ src
โ   โโโ shared                     # ฺฉุฏ ูุดุชุฑฺฉ ุจู ฺฉูุงูุช ู ุณุฑูุฑ
โ   โ   โโโ types.ts               # ุชุนุฑู Type ูุง ูุซู Item, InitialData
โ   โโโ server
โ   โ   โโโ index.ts               # ูุฑูุฏ ุงุตู ุณุฑูุฑ (Express)
โ   โ   โโโ db.ts                  # ููุจุน ุฏุงุฏู ุณุงุฏู ุฏุฑ ุญุงูุธู (in-memory)
โ   โ   โโโ ssr.tsx                # ุชุงุจุน renderHtml (SSR + ุชุฒุฑู InitialData)
โ   โ   โโโ etag.ts                # ุชููุฏ ETag ุงุฒ ุฑู HTML
โ   โโโ client
โ       โโโ main.tsx               # ููุทู ูุฑูุฏ ฺฉูุงูุช (hydrateRoot)
โ       โโโ App.tsx                 # ุฑุดู ุงูพุ ุดุงูู BrowserRouter
โ       โโโ style.css               # ุงุณุชุงู Tailwind
โ       โโโ components/             # ฺฉุงููพูููุชโูุง ูุงุจู ุงุณุชูุงุฏู ูุฌุฏุฏ
โ       โโโ context/                # Context ูุง React
โ       โโโ hooks/                  # Custom Hooks
โ       โโโ pages/                  # ุตูุญุงุช ุงุตู ุงูพูฺฉุดู
โ       โโโ Routes/                 # ุชุนุฑู Routeูุง
โ       โโโ constant/               # ุซูุงุจุช ู ุชูุธูุงุช
```

---

## 1) ูุนูุงุฑ ฺฉู

ูพุฑูฺู ุงุฒ ุณู ูุงู ุงุตู ุชุดฺฉู ุดุฏู ุงุณุช:

### **Shared Layer (`src/shared/`)**
- ุดุงูู typeูุง ูุดุชุฑฺฉ ุจู ุณุฑูุฑ ู ฺฉูุงูุช (ูุซู `Item`, `InitialData`)
- ุฌููฺฏุฑ ุงุฒ ุชฺฉุฑุงุฑ typeูุง ู ููุงููฺฏ ุจู ุฏู ุณูุช

### **Server Layer (`src/server/`)**
- ุงุฌุฑุง SSR ุจุง `ReactDOMServer.renderToString`
- ุณุงุฎุช `InitialData` ุจุฑ ุงุณุงุณ route ู ุชุฒุฑู ุจู HTML
- API: `GET /api/items`, `GET /api/items/:id`
- ูพุงุฏูโุณุงุฒ ETag ุจุฑุง ูพุงุณุฎโูุง SSR (ุชููุฏ hash ุงุฒ HTMLุ ุจุฑฺฏุฑุฏุงูุฏู `304 Not Modified`)

### **Client Layer (`src/client/`)**
- ุงุฌุฑุง React ุฑู ูุฑูุฑฺฏุฑ ุจุง `hydrateRoot`
- ุงุณุชูุงุฏู ุงุฒ ุฏุงุฏู SSR ุงุฒ ุทุฑู `InitialDataContext`
- React Router ุจุฑุง ูุงูุจุฑ ุณูุช ฺฉูุงูุช
- ุฏุฑ ูุงูุจุฑ ุฏุงุฎู (SPA)ุ ุฏุงุฏู ุงุฒ API ุฏุฑุงูุช ูโุดูุฏ

---

## 2) ุฌุฑุงู SSR โ Hydration

1. ฺฉุงุฑุจุฑ ฺฉ URL ูุซู `/items/2` ุฑุง ุจุงุฒ ูโฺฉูุฏ
2. ุณุฑูุฑ ุฏุงุฏู ุฑุง ูโุฎูุงูุฏุ React ุฑุง ุจุง `StaticRouter` ุฑูุฏุฑ ูโฺฉูุฏ ู HTML + InitialData ุชููุฏ ูโฺฉูุฏ
3. ูุฑูุฑฺฏุฑ HTML ฺฉุงูู ุฑุง ูโุจูุฏ (ุจุฏูู ุงูุชุธุงุฑ ุจุฑุง JS)
4. ุฌุงูุงุงุณฺฉุฑูพุช ฺฉูุงูุช ููุฏ ูโุดูุฏ
5. `hydrateRoot` ุฑู HTML ููุฌูุฏ ุงุฌุฑุง ูโุดูุฏ ู UI React ูุนุงู ูโุดูุฏ

---

## 3) ETag & Cache Validation

ุจุฑุง ูพุงุณุฎ SSR:
- ฺฉ hash ุงุฒ ูุญุชูุง HTML ุชููุฏ ูโุดูุฏ ู ุฏุฑ ูุฏุฑ `ETag` ูุฑุงุฑ ูโฺฏุฑุฏ
- ุงฺฏุฑ ุฏุฑุฎูุงุณุช ูุฌุฏุฏ ุจุง `If-None-Match` ุงุฑุณุงู ุดูุฏ:
  - ุฏุฑ ุตูุฑุช ุจุฑุงุจุฑ ุจูุฏู โ `304 Not Modified`
  - ุฏุฑ ุบุฑ ุงู ุตูุฑุช โ `200` + HTML ุฌุฏุฏ

ุงู ฺฉุงุฑ ุจุงุนุซ ฺฉุงูุด ุฑูุฏุฑ ุบุฑุถุฑูุฑ ู ุตุฑููโุฌู ุฏุฑ ูพููุง ุจุงูุฏ ูโุดูุฏ.

---

## 4) ุฑูุชุงุฑ ุฏุงุฏูโูุง (InitialData)

**ุฏุฑ ุฑูุฏุฑ ุงููู (SSR):** ุฏุงุฏูโูุง ุฏุฑ ุณุฑูุฑ fetch ูโุดููุฏุ ุฏุฑ HTML ุชุฒุฑู ูโุดููุฏ ู ฺฉูุงูุช ุจุฏูู fetch ุฏูุจุงุฑูุ ุตูุญู ุฑุง hydrate ูโฺฉูุฏ.

**ุฏุฑ ูุงูุจุฑ ุฏุงุฎู (SPA):** React Router ููุท route ุฑุง ุนูุถ ูโฺฉูุฏ. ุงฺฏุฑ InitialData ููุงุณุจ ุตูุญู ุฌุฏุฏ ูุจุงุดุฏ โ fetch ุงุฒ API ุงูุฌุงู ูโุดูุฏ.

---

## 5) Design Patterns Used

ุฏุฑ ุงู ูพุฑูฺู ฺูุฏ ุงูฺฏู ูุนูุงุฑ/ุฏุฒุงู ูพุชุฑู ุงุณุชูุงุฏู ุดุฏู ฺฉู ฺฉูฺฉ ูโฺฉููุฏ SSRุ ูุฏุฑุช ุฏุงุฏู ู ุณุงุฒูุงูโุฏู ฺฉุฏ ุชูุฒุชุฑ ุจุงุดุฏ:

### **1. Separation of Concerns (SOC)**
ฺฉุฏ ุจู ุณู ูุงู ูุฌุฒุง ุชูุณู ุดุฏู ุงุณุช:
- Server (SSR + API)
- Client (React + Router + Hydration)
- Shared (Types)

ุงู ุฌุฏุงุณุงุฒ ุจุงุนุซ ุชุณุชโูพุฐุฑ ู ุชูุณุนูโูพุฐุฑ ุจูุชุฑ ูโุดูุฏ.

### **2. Single Source of Truth**
Typeูุง ู ูุฏู ุฏุงุฏูโูุง ููุท ฺฉโุจุงุฑ ุฏุฑ `src/shared/types` ุชุนุฑู ุดุฏูโุงูุฏ ู ฺฉูุงูุช ู ุณุฑูุฑ ุงุฒ ููุงู ุงุณุชูุงุฏู ูโฺฉููุฏ.

### **3. Context Provider Pattern**
`InitialDataContext` ุจุฑุง ุงู ุงุณุชูุงุฏู ุดุฏู ฺฉู:
- ุฏุงุฏูโ SSR ุดุฏู ููุท ฺฉโุจุงุฑ ุชุฒุฑู ุดูุฏ
- ุฏุฑ ฺฉูุงูุช ุจุฏูู props drilling ุฏุฑ ุฏุณุชุฑุณ ุจุงุดุฏ
- ุงุฒ double-fetch ุฌููฺฏุฑ ุดูุฏ

### **4. Factory / Builder Pattern (ุฏุฑ SSR HTML Rendering)**
ุชุงุจุน `renderHtml` ููุด ฺฉ **builder** ุฑุง ุฏุงุฑุฏ:
- ุณุฑูุฑ โ JSX โ HTML
- ุชุฒุฑู InitialData
- ุงุถุงููโฺฉุฑุฏู assetูุง (ุฏุฑ dev ุง prod)

### **5. Strategy Pattern (Routing Strategy)**
ุจุฑุง SSR ู Client Routing ุงุฒ ุฏู ุงุณุชุฑุงุชฺ ูุฎุชูู ุงุณุชูุงุฏู ุดุฏู:
- ุณุฑูุฑ โ `StaticRouter`
- ฺฉูุงูุช โ `BrowserRouter`

ุงูุง ูุฑ ุฏู ฺฉ ุณุงุฎุชุงุฑ route ูุดุชุฑฺฉ ุฑุง ูโุฎูุงููุฏ (`AppRoutes`).

### **6. Cache Validation Pattern (ETag)**
ุงุฒ ETag ุจูโุนููุงู ฺฉ **content-based caching strategy** ุงุณุชูุงุฏู ุดุฏู ฺฉู ูุนุงุฏู ูพุงุฏูโุณุงุฒ ุงูฺฏู **Cache Validation** ุฏุฑ HTTP ุงุณุช.

### **7. Progressive Enhancement**
ุตูุญู ุงุจุชุฏุง ุจุง HTML ฺฉุงูู (SSR) ููุงุด ุฏุงุฏู ูโุดูุฏ ู ุณูพุณ React ุจุง **Hydration** ูุงุจูุชโูุง ุชุนุงูู ุฑุง ุงุถุงูู ูโฺฉูุฏ.

---

## 6) UI โ Mobile-first

- ฺฉู UI ุจุง TailwindCSS ุทุฑุงุญ ุดุฏู
- ุณุงุฎุชุงุฑ ุงูพ ุดุจู ุงูพ ููุจุงู (`max-w-xl`, `mx-auto`)
- ุฑู ุฏุณฺฉุชุงูพ ุจูโุตูุฑุช centered mobile-view ููุงุด ุฏุงุฏู ูโุดูุฏ

---

## 7) ูฺฉุงุช ูุงุจู ุจูุจูุฏ

- ุงุณุชูุงุฏู ุงุฒ manifest Vite ุจุฑุง ุจุงุฑฺฏุฐุงุฑ CSS ู JS ุฏุฑ production
- ุงุถุงููโฺฉุฑุฏู caching ุณูุช ฺฉูุงูุช (React Query)
- ุงุถุงููโฺฉุฑุฏู ุชุณุชโูุง ูุงุญุฏ
- ุงูุฒูุฏู error boundaryูุง ู skeleton loaders

---

ุงู ูุนูุงุฑ ุชูุฑฺฉุฒ ุฏุงุฑุฏ ุฑู:  
**SSR ูุงูุนุ ุฌููฺฏุฑ ุงุฒ double-fetchุ ETagุ ู ุณุงุฏฺฏ ุฏุฑ ุณุงุฎุชุงุฑ.**
